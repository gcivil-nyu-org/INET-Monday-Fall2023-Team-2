{% extends "base.html" %}
{% block title %}
    Profile
{% endblock title %}
{% block content %}
    <div class="container mx-auto mt-40 mb-10">
        <div>
            <div class="bg-white relative shadow-lg rounded-lg w-5/6 md:w-5/6 lg:w-4/6 xl:w-3/6 mx-auto">
                <div class="flex justify-center">
                    {% if profile.profile_picture %}
                        {% comment %} Profile Picture with same shape {% endcomment %}
                    {% else %}
                        <div class="rounded-full bg-[#ff6a45] flex items-center justify-center ml-2 mx-auto absolute -top-20 w-32 h-32 shadow-md border-4 border-white transition duration-200 transform hover:scale-110">
                            <span class="text-white text-3xl">{{ profile.full_name|first|capfirst }}</span>
                        </div>
                    {% endif %}
                    <div class="mt-16 flex flex-col items-center">
                        <h1 class="font-bold text-center text-3xl text-black">{{ profile.full_name|capfirst }}</h1>
                        <div class="flex items-center mt-1">
                            <span class="font-small text-xs leading-none text-gray-500">@{{ profile.username }}</span>
                            <span class="font-small text-xs leading-none text-gray-500 ml-1">â€¢</span>
                            <span class="font-small text-xs leading-none text-gray-500 ml-1">{{ user.get_pronouns_display }}</span>
                        </div>
                        <div class="m-3 flex flex-wrap">
                            {% for tag in profile.tags.all %}
                                <span class="bg-white border-blue-600 border text-blue-600 px-3 py-1 m-1 rounded-full">{{ tag.name }}</span>
                            {% endfor %}
                        </div>
                        {% if user == profile %}
                            <div class="flex items-center m-2">
                                <div class="flex justify-between items-center">
                                    <a href="{% url 'main:edit_profile_page' user.username %}"
                                       class="relative inline-flex items-center justify-center p-4 px-6 py-3 overflow-hidden font-medium text-[#ff6a45] transition duration-300 ease-out border-2 border-[#ff6a45] rounded-full shadow-md group">
                                        <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-[#ff6a45] group-hover:translate-x-0 ease">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                 fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke-width="1.5"
                                                 stroke="currentColor"
                                                 class="w-6 h-6">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                                            </svg>
                                        </span>
                                        <span class="absolute flex items-center justify-center w-full h-full text-[#ff6a45] transition-all duration-300 transform group-hover:translate-x-full ease">Edit Profile</span>
                                        <span class="relative invisible">Edit Profile</span>
                                    </a>
                                </div>
                                <div class="flex justify-between items-center ml-3">
                                    <a href="{% url 'main:edit_profile_page' user.username %}"
                                       class="relative inline-flex items-center justify-center py-2 overflow-hidden font-medium text-[#ff6a45] transition duration-300 ease-out border-2 border-[#ff6a45] rounded-full shadow-md group w-12 h-12">
                                        <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 ease">
                                            <!-- White background with orange gear -->
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z" />
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>

                                        </span>
                                        <span class="absolute flex items-center justify-center w-full h-full text-[#ff6a45] transition-all duration-300 ease group-hover:bg-[#ff6a45] group-hover:text-white">
                                            <!-- Orange background with white gear -->
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z" />
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                        </span>
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            {% comment %} Connection, Chat, Block buttons {% endcomment %}
                            <div class="flex items-center mt-5">
                                <div class="flex flex-wrap justify-center items-center">
                                    {% if connection.status == connection.ConnectionStatus.NOT_CONNECTED %}
                                        <a href="{% url 'main:request_connection' receiver=profile.username %}"
                                           class="px-4 py-2 mt-2 inline-flex items-center justify-center text-base font-medium text-center text-green-500 border border-green-500 rounded-lg shadow-sm cursor-pointer hover:text-green-900 bg-white">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                 fill="none"
                                                 viewBox="0 0 24 24"
                                                 stroke-width="1.5"
                                                 stroke="currentColor"
                                                 class="w-6 h-6 mr-1">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.25 6.087c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.036-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959v0a.64.64 0 01-.657.643 48.39 48.39 0 01-4.163-.3c.186 1.613.293 3.25.315 4.907a.656.656 0 01-.658.663v0c-.355 0-.676-.186-.959-.401a1.647 1.647 0 00-1.003-.349c-1.036 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401v0c.31 0 .555.26.532.57a48.039 48.039 0 01-.642 5.056c1.518.19 3.058.309 4.616.354a.64.64 0 00.657-.643v0c0-.355-.186-.676-.401-.959a1.647 1.647 0 01-.349-1.003c0-1.035 1.008-1.875 2.25-1.875 1.243 0 2.25.84 2.25 1.875 0 .369-.128.713-.349 1.003-.215.283-.4.604-.4.959v0c0 .333.277.599.61.58a48.1 48.1 0 005.427-.63 48.05 48.05 0 00.582-4.717.532.532 0 00-.533-.57v0c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.035 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.37 0 .713.128 1.003.349.283.215.604.401.96.401v0a.656.656 0 00.658-.663 48.422 48.422 0 00-.37-5.36c-1.886.342-3.81.574-5.766.689a.578.578 0 01-.61-.58v0z" />
                                            </svg>
                                            <span class="relative">Connect</span>
                                        </a>
                                    {% elif connection.status == connection.ConnectionStatus.REQUESTED %}
                                        <a href="{% url 'main:cancel_connection' requester=user.username receiver=profile.username %}"
                                           class="px-4 py-2 mt-2 relative inline-flex items-center justify-center overflow-hidden text-base font-medium text-white transition duration-300 ease-out bg-yellow-500 rounded-lg shadow-sm group">
                                            <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-red-500 group-hover:translate-x-0 ease">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke-width="1.5"
                                                     stroke="currentColor"
                                                     class="w-6 h-6">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                            </span>
                                            <span class="absolute flex items-center justify-center w-full h-full text-white transition-all duration-300 transform group-hover:translate-x-full ease">Requested</span>
                                            <span class="relative invisible">Requested</span>
                                        </a>
                                    {% elif connection.status == connection.ConnectionStatus.CONNECTED %}
                                        <a href="{% url 'main:cancel_connection' requester=user.username receiver=profile.username %}"
                                           class="px-4 py-2 mt-2 relative inline-flex items-center justify-center overflow-hidden text-base font-medium text-white transition duration-300 ease-out bg-green-500 rounded-lg shadow-sm group">
                                            <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-red-500 group-hover:translate-x-0 ease">
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                     fill="none"
                                                     viewBox="0 0 24 24"
                                                     stroke-width="1.5"
                                                     stroke="currentColor"
                                                     class="w-6 h-6">
                                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                            </span>
                                            <span class="absolute flex items-center justify-center w-full h-full text-white transition-all duration-300 transform group-hover:translate-x-full ease">Connected</span>
                                            <span class="relative invisible">Connected</span>
                                        </a>
                                    {% elif connection.status == connection.ConnectionStatus.BLOCKED %}
                                    {% endif %}
                                    <a href="{% url 'chat:chat_room_create' requester=user.username receiver=profile.username %}"
                                       class="px-4 py-2 ml-3 mt-2 inline-flex items-center justify-center text-base font-medium text-center text-blue-500 border border-blue-500 rounded-lg shadow-sm cursor-pointer hover:text-blue-900 bg-white">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke-width="1.5"
                                             stroke="currentColor"
                                             class="w-6 h-6 mr-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.068.157 2.148.279 3.238.364.466.037.893.281 1.153.671L12 21l2.652-3.978c.26-.39.687-.634 1.153-.67 1.09-.086 2.17-.208 3.238-.365 1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" />
                                        </svg>
                                        <span class="relative">Chat</span>
                                    </a>
                                    <a href="#"
                                       class="px-4 py-2 ml-3 mt-2 inline-flex items-center justify-center text-base font-medium text-center text-red-500 border border-red-500 rounded-lg shadow-sm cursor-pointer hover:text-red-900 bg-white">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke-width="1.5"
                                             stroke="currentColor"
                                             class="w-6 h-6 mr-1">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                                        </svg>
                                        <span class="relative">Block</span>
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% if user == profile %}
                <div class="flex flex-wrap mx-5" id="tabs-id">
                    <div class="w-full">
                        <ul class="flex mb-0 list-none flex-wrap pt-3 pb-4 flex-row">
                            <li class="-mb-px mr-2 last:mr-0 flex-auto text-center">
                                <a class="text-xs font-bold uppercase px-5 py-3 shadow-lg rounded block leading-normal text-white bg-[#ff6a45]"
                                   onclick="changeActiveTab(event,'tab-active-posts')">
                                    <i class="fas fa-space-shuttle text-base mr-1"></i>  Active Posts
                                </a>
                            </li>
                            <li class="-mb-px mr-2 last:mr-0 flex-auto text-center">
                                <a class="text-xs font-bold uppercase px-5 py-3 shadow-lg rounded block leading-normal text-[#ff6a45] bg-white"
                                   onclick="changeActiveTab(event,'tab-drafted-posts')">
                                    <i class="fas fa-cog text-base mr-1"></i>  Drafted Posts
                                </a>
                            </li>
                            <li class="-mb-px mr-2 last:mr-0 flex-auto text-center">
                                <a class="text-xs font-bold uppercase px-5 py-3 shadow-lg rounded block leading-normal text-[#ff6a45] bg-white"
                                   onclick="changeActiveTab(event,'tab-archived-posts')">
                                    <i class="fas fa-briefcase text-base mr-1"></i>  Archived Posts
                                </a>
                            </li>
                        </ul>
                        <div class="overflow-y-auto max-h-full relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-lg rounded">
                            <div class="px-4 py-5 flex-auto">
                                <div class="tab-content tab-space">
                                    <div class="block" id="tab-active-posts">
                                        {% if active_posts %}
                                            {% for post in active_posts %}
                                                {% include "posts/post_card.html" with post=post %}
                                            {% endfor %}
                                        {% else %}
                                            <p>No Active Posts. You should make one!</p>
                                        {% endif %}
                                    </div>
                                    <div class="hidden" id="tab-drafted-posts">
                                        {% if drafted_posts %}
                                            {% for post in drafted_posts %}
                                                {% include "posts/post_card.html" with post=post %}
                                            {% endfor %}
                                        {% else %}
                                            <p>No Drafted Posts</p>
                                        {% endif %}
                                    </div>
                                    <div class="hidden" id="tab-archived-posts">
                                        {% if archived_posts %}
                                            {% for post in archived_posts %}
                                                {% include "posts/post_card.html" with post=post %}
                                            {% endfor %}
                                        {% else %}
                                            <p>No Archived Posts</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script type="text/javascript">
            function changeActiveTab(event,tabID){
              let element = event.target;
              while(element.nodeName !== "A"){
                element = element.parentNode;
              }
              ulElement = element.parentNode.parentNode;
              aElements = ulElement.querySelectorAll("li > a");
              tabContents = document.getElementById("tabs-id").querySelectorAll(".tab-content > div");
              for(let i = 0 ; i < aElements.length; i++){
                aElements[i].classList.remove("text-white");
                aElements[i].classList.remove("bg-[#ff6a45]");
                aElements[i].classList.add("text-[#ff6a45]");
                aElements[i].classList.add("bg-white");
                tabContents[i].classList.add("hidden");
                tabContents[i].classList.remove("block");
              }
              element.classList.remove("text-[#ff6a45]");
              element.classList.remove("bg-white");
              element.classList.add("text-white");
              element.classList.add("bg-[#ff6a45]");
              document.getElementById(tabID).classList.remove("hidden");
              document.getElementById(tabID).classList.add("block");
            }
                </script>
            </div>
        {% else %}
            <div div
                 class="relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-lg rounded">
                <div class="px-4 py-5 flex-auto">
                    <div>
                        <div class="block border-black">
                            {% if active_posts %}
                                {% for post in active_posts %}
                                    {% include "posts/post_card.html" with post=post %}
                                {% endfor %}
                            {% else %}
                                <p class="text-center mt-5">{{ profile.username|capfirst }} has not made any posts.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock content %}
